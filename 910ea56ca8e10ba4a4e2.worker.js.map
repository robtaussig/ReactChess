{"version":3,"sources":["webpack:///webpack/bootstrap 910ea56ca8e10ba4a4e2","webpack:///./logic/move_worker.js","webpack:///./logic/board_node.js","webpack:///./logic/ai.js"],"names":["BoardNode","require","Ai","self","onmessage","e","specMoves","data","specialMoves","testBoard","dupe","board","pieces","depth","bestMove","findBestMove","workerResult","moveData","Object","assign","move","checkmate","enPassant","castle","postMessage","side","currentSide","score","evaluateMove","newBoard","testMove","ownPieces","findAllPieces","otherPieces","materialScore","evalMaterial","positionalScore","evalPosition","tacticScore","evalTactics","evalDoubleAttacks","evalCheckmate","moves","parseMoveClusters","map","findAllLegalMovesByPiece","piece","length","attackedPieces","forEach","lvA","leastValuableAttacker","defended","PIECE_VALUES","type","push","sorted","sort","a","b","secondBestAttack","Math","max","ownScore","reduce","sum","el","otherScore","evalPiecePositionalValue","findAttackers","pos","value","pawnPositionalValue","rookPositionalValue","knightPositionalValue","bishopPositionalValue","queenPositionalValue","kingPositionalValue","pawn","posX","posY","abs","rook","knight","bishop","queen","king","left","right","yDir","filter","testSquare","xCoord","module","exports","canMove","toX","toY","from","notInCheck","checkMove","bishopMoves","selected","x","y","dx","dy","rookMoves","queenMoves","knightMoves","kingMoves","checkPawnCaptures","color","oppColor","dX","dY","status","afterMove","findKing","colorToCheck","sameSide","returnResult","coord","step","checkObstruction","to","start","array","duped","i","j","target","checkCastle","checkPawnObstruction","pawnMoves","castleQueenSideStatus","castleKingSideStatus","xStep","yStep","castleRook","checkEnPassant","rightSide","leftSide","captureEnPassant"],"mappings":"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","file":"910ea56ca8e10ba4a4e2.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 910ea56ca8e10ba4a4e2\n **/","const BoardNode = require('./board_node.js');\nconst Ai = require('./ai.js');\n\nself.onmessage = function (e) {\n  let specMoves = e.data.data.specialMoves;\n  let testBoard = Ai.dupe(e.data.data.board.pieces);\n  let depth = e.data.data.depth;\n  let bestMove = BoardNode.findBestMove(testBoard,specMoves,depth);\n  let workerResult = 'Message received!';\n  let moveData = Object.assign({move: [], checkmate: false, enPassant: false, castle: false},bestMove);\n  postMessage(moveData);\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./logic/move_worker.js\n **/","class BoardNode {\n  constructor(move,pieces,specialMoves,depth) {\n    this.move = move;\n    this.pieces = pieces;\n    this.specialMoves = specialMoves;\n    this.side = specialMoves.currentSide;\n    this.depth = depth;\n    this.checkmate = false;\n    this.score = this.evaluateMove();\n  }\n\n  evaluateMove () {\n    let newBoard = testMove(dupe(this.pieces),this.move[0],this.move[1]);\n    let ownPieces = findAllPieces(newBoard,this.side);\n    let otherPieces = findAllPieces(newBoard,this.side === 'w' ? 'b' : 'w');\n    let materialScore = this.evalMaterial(newBoard, ownPieces, otherPieces);\n    let positionalScore = this.evalPosition(newBoard, ownPieces);\n    let tacticScore = this.evalTactics(newBoard, ownPieces, otherPieces);\n    return materialScore + positionalScore + tacticScore;\n  }\n\n  evalTactics (ownPieces, otherPieces) {\n    let tacticScore = 0;\n    tacticScore += this.evalDoubleAttacks(this.pieces,otherPieces);\n    this.evalCheckmate();\n    return tacticScore;\n  }\n\n  evalCheckmate () {\n    let moves = parseMoveClusters(\n                  findAllPieces(this.pieces,this.side === 'w' ? 'b' : 'w')\n                  .map(piece=> findAllLegalMovesByPiece(piece,this.pieces,this.specialMoves))\n                );\n    if (moves.length === 0) {\n      this.checkmate = true;\n    }\n  }\n\n  evalDoubleAttacks(board,otherPieces) {\n    let attackedPieces = [];\n    otherPieces.forEach(piece => {\n      let lvA = this.leastValuableAttacker(board,piece);\n      if (lvA > 0) {\n        let defended = this.defended(board,piece);\n        let score = PIECE_VALUES[piece.type];\n          attackedPieces.push([score - lvA * defended]);\n      }\n    });\n    let sorted = attackedPieces.sort((a,b)=>b-a);\n    let secondBestAttack = sorted[1] || 0;\n    return Math.max(secondBestAttack,0);\n  }\n\n  evalMaterial (board, ownPieces, otherPieces) {\n    let ownScore =  ownPieces\n                    .map(piece => PIECE_VALUES[piece.type])\n                    .reduce((sum,el) => sum + el);\n\n    let otherScore = otherPieces\n                      .map(piece => PIECE_VALUES[piece.type])\n                      .reduce((sum,el) => sum + el);\n\n    return ownScore - otherScore;\n  }\n\n  evalPosition (board, ownPieces) {\n    let ownScore = ownPieces\n                    .map(piece=> this.evalPiecePositionalValue(piece,board))\n                    .reduce((sum,el) => sum + el);\n    return ownScore;\n  }\n\n  defended (board, piece) {\n    //Can use the findAttacker method but with own side to check for defended status\n    let defended = findAttackers(piece.pos, board, piece.side, true)[0];\n    if (defended) {\n      return 1;\n    } else {\n      return 0;\n    }\n  }\n\n  leastValuableAttacker (board, piece) {\n    let lvA = findAttackers (piece.pos, board, piece.side === 'w' ? 'b' : 'w', false);\n    if (lvA[0] && lvA[0][0]) {\n      return PIECE_VALUES[lvA[0][1]];\n    } else {\n      return 0;\n    }\n  }\n\n  evalPiecePositionalValue (piece,board) {\n    let value = 0;\n    switch (piece.type) {\n      case 'p':\n        value = this.pawnPositionalValue(piece,board);\n        break;\n      case 'r':\n        value = this.rookPositionalValue(piece,board);\n        break;\n      case 'n':\n        value = this.knightPositionalValue(piece,board);\n        break;\n      case 'b':\n        value = this.bishopPositionalValue(piece,board);\n        break;\n      case 'q':\n        value = this.queenPositionalValue(piece,board);\n        break;\n      case 'k':\n        value = this.kingPositionalValue(piece,board);\n        break;\n      default:\n\n    }\n    return value;\n  }\n\n  pawnPositionalValue (pawn,board) {\n    let posX = pawn.pos[0],\n      posY = pawn.pos[1],\n      value = 0;\n\n    value += (\n      30 * (0.25 / (Math.abs(3.5 - posY) * (Math.abs(3.5 - posX))))\n    );\n    let lvA = this.leastValuableAttacker (board, pawn);\n    if (lvA > 0) {\n      value -= Math.max(PIECE_VALUES[pawn.type] - lvA * (this.defended(board,pawn)),0);\n    }\n\n    return value;\n  }\n\n  rookPositionalValue (rook,board) {\n    let moves = findAllLegalMovesByPiece (rook,board,this.specialMoves);\n    let value = 0;\n\n    let lvA = this.leastValuableAttacker (board, rook);\n    if (lvA > 0) {\n      value -= Math.max(PIECE_VALUES[rook.type] - lvA * (this.defended(board,rook)),0);\n    }\n    return moves.length * 5 + value;\n  }\n\n  knightPositionalValue (knight,board) {\n    let value = 0;\n    let moves = findAllLegalMovesByPiece (knight,board,this.specialMoves);\n    moves.forEach(move => {\n      value += (\n        12 * (0.25 / Math.abs(3.5 - move[1][1]) * (Math.abs(3.5 - move[1][0])))\n      );\n    });\n    let lvA = this.leastValuableAttacker (board, knight);\n    if (lvA > 0) {\n      value -= Math.max(PIECE_VALUES[knight.type] - lvA * (this.defended(board,knight)),0);\n    }\n    if (this.defended(board,knight)) {\n      value += 25;\n    }\n    return value;\n  }\n\n  bishopPositionalValue (bishop,board) {\n    let value = 0;\n    let moves = findAllLegalMovesByPiece (bishop,board,this.specialMoves);\n    let lvA = this.leastValuableAttacker (board, bishop);\n    if (lvA > 0) {\n      value -= Math.max(PIECE_VALUES[bishop.type] - lvA * (this.defended(board,bishop)),0);\n    }\n    if (this.defended(board,bishop)) {\n      value += 25;\n    }\n    return moves.length * 8 + value;\n  }\n\n  queenPositionalValue (queen,board) {\n    let value = 0;\n    let moves = findAllLegalMovesByPiece (queen,board,this.specialMoves);\n    let lvA = this.leastValuableAttacker (board, queen);\n    if (lvA > 0) {\n      value -= Math.max(PIECE_VALUES[queen.type] - lvA * (this.defended(board,queen)),0);\n    }\n\n    return moves.length * 2 + value;\n  }\n\n  kingPositionalValue (king,board) {\n    let posX = king.pos[0],\n      posY = king.pos[1],\n      value = 0,\n      left = posX === 0 ? null : (posX - 1),\n      right = posX === 7 ? null : (posX + 1),\n      yDir = king.side === 'w' ?\n      (posY === 0 ? null : (posY - 1)) : (posY === 7 ? null : (posY + 1));\n    [left, posX, right].filter(el=>el).forEach(xCoord => {\n      let testSquare = board[yDir][xCoord][0];\n      if (testSquare[0] === king.side) {\n        if (testSquare[2] === 'p') {\n          value += 30;\n        } else {\n          value += 20;\n        }\n      }\n    });\n    if ((king.pos[0] === 6) || (king.pos[0] === 2)) {\n      value += 100;\n    }\n    return value;\n  }\n}\n\nmodule.exports = BoardNode;\n\n\n\n/** WEBPACK FOOTER **\n ** ./logic/board_node.js\n **/","module.exports = {\n  specialMoves: {},\n\n  canMove(toX, toY, pieces, from,specMoves) {\n    specialMoves = specMoves;\n    // if (from[0] === 4 && from[1] === 0 && toX === 5 && toY === 1) debugger\n    if (notInCheck(toX, toY, from, pieces)) {\n      if (checkMove(toX, toY, pieces, from)) return true;\n    }\n    return false;\n  },\n\n  bishopMoves (selected, toX, toY) {\n    let [x, y] = selected;\n    let dx = toX - x;\n    let dy = toY - y;\n    return (Math.abs(dx) / Math.abs(dy) === 1);\n  },\n\n  rookMoves (selected, toX, toY) {\n    let [x, y] = selected;\n    let dx = toX - x;\n    let dy = toY - y;\n    return (dx === 0 && dy !== 0|| dy === 0 && dx !== 0);\n  },\n\n  queenMoves (selected, toX, toY) {\n    let [x, y] = selected;\n    let dx = toX - x;\n    let dy = toY - y;\n    return (Math.abs(dx) / Math.abs(dy) === 1) ||\n    (dx === 0 && dy !== 0|| dy === 0 && dx !== 0);\n  },\n\n  knightMoves (selected,toX, toY) {\n    const [x, y] = selected;\n    const dx = toX - x;\n    const dy = toY - y;\n    return (Math.abs(dx) === 2 && Math.abs(dy) === 1) ||\n           (Math.abs(dx) === 1 && Math.abs(dy) === 2);\n  },\n\n  kingMoves (selected, toX, toY) {\n    const [x, y] = selected;\n    const dx = toX - x;\n    const dy = toY - y;\n    return (Math.abs(dx) <= 1 && Math.abs(dy) <= 1) &&\n           (Math.abs(dx) + Math.abs(dy) > 0);\n  },\n\n  checkPawnCaptures (toX, toY, pawn, pieces) {\n    const [x, y] = pawn;\n    const color = pieces[y][x][0][0];\n    const oppColor = color === 'w' ? 'b' : 'w';\n    const dX = toX - x;\n    const dY = toY - y;\n    const enPassant = specialMoves[color].enPassant;\n    if (color === 'w' && dY > 0 || color === 'b' && dY< 0) {\n      return false;\n    } else if (Math.abs(dX) === 1 && Math.abs(dY) === 1 &&\n      pieces[toY][toX][0][0] !== color &&\n      pieces[toY][toX][0][0] !== 'n') {\n        return true;\n      } else if (enPassant.status) {\n        if (pawn[0] === enPassant.pos[0] && pawn[1] === enPassant.pos[1] &&\n          toX === x + enPassant.pos[2] && Math.abs(dY) === 1) {\n            return true;\n        }\n      }\n    return false;\n  },\n\n  notInCheck (toX, toY, from, pieces) {\n    let color = pieces[from[1]][from[0]][0][0];\n    let testBoard = dupe(pieces);\n    let afterMove = testMove(testBoard, from, [toX, toY]);\n    let king = findKing(afterMove,color); //[y,x];\n    if (findAttackers(king,afterMove,color==='w'?'b':'w',false).length > 0) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  findAttackers (piece, board, colorToCheck, sameSide) {\n    if (!piece) return false;\n    let yDir = colorToCheck === 'w' ? piece[1] + 1 : piece[1] - 1;\n    let left = piece[0] - 1;\n    let right = piece[0] + 1;\n    let returnResult = [];\n    //test for pawns\n    if (left >= 0 && left <= 7 && yDir >= 0 && yDir <= 7 &&\n      board[yDir][left][0] === `${colorToCheck}-p`) {\n      returnResult.push([true,'p']);\n    } else if (right >= 0 && right <= 7 && yDir >= 0 && yDir <= 7 &&\n      board[yDir][right][0] === `${colorToCheck}-p`) {\n      returnResult.push([true, 'p']);\n    }\n    //test for knights\n    [[1,2],[1,-2],[-1,2],[-1,-2],[2,1],[2,-1],[-2,1],[-2,-1]].forEach(coord => {\n      let x = piece[0] + coord[0];\n      let y = piece[1] + coord[1];\n      if (x >= 0 && x <=7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-n`) {\n          returnResult.push([true, 'n']);\n        }\n      }\n    });\n    //test for bishops/queens\n    [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(step => {\n      let x = piece[0] + step[0],\n        y = piece[1] + step[1];\n      while (x >= 0 && x <= 7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-b` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true, 'b']);\n        } else if (board[y][x][0] === `${colorToCheck}-q` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true, 'q']);\n        }\n        x += step[0];\n        y += step[1];\n      }\n    });\n    //test for rooks/queens\n    [[0,1],[0,-1],[-1,0],[1,0]].forEach(step => {\n      let x = piece[0] + step[0],\n        y = piece[1] + step[1];\n      while (x >= 0 && x <= 7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-r` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true, 'r']);\n        } else if (board[y][x][0] === `${colorToCheck}-q` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true,'q']);\n        }\n        x += step[0];\n        y += step[1];\n      }\n    });\n\n    //test for king\n    [[0,1],[0,-1],[-1,0],[1,0],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(coord => {\n      let x = piece[0] + coord[0];\n      let y = piece[1] + coord[1];\n      if (x >= 0 && x <= 7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-k`) {\n          returnResult.push([true, 'k']);\n        }\n      }\n    });\n    return returnResult;\n  },\n\n  testMove (testBoard, from, to) {\n    let selected = from;\n    let start = testBoard[selected[1]][selected[0]][0];\n    let color = start[0];\n    if (testBoard[to[1]][to[0]][0][0] !== color) {\n      testBoard[to[1]][to[0]][0] = start;\n      testBoard[selected[1]][selected[0]][0] = 'n-l';\n    }\n    return testBoard;\n  },\n\n  dupe (array) {\n    const duped = [[],[],[],[],[],[],[],[]];\n    for (let i=0;i<array.length;i++) {\n      for (let j=0;j<array[i].length;j++) {\n        let piece = `${array[i][j][0][0]}-${array[i][j][0][2]}`;\n        duped[i].push([piece]);\n      }\n    }\n    return duped;\n  },\n\n  findKing (pieces,color) {\n    const target = `${color}-k`;\n    for (let i=0; i<=7;i++) {\n      for (let j=0; j<=7;j++) {\n        if (pieces[i][j][0] === target) {\n          return [j, i];\n        }\n      }\n    }\n  },\n\n  checkMove (toX, toY, pieces, from) {\n    let pos = from;\n    let piece = pieces[pos[1]][pos[0]][0];\n    let color = pieces[pos[1]][pos[0]][0][0];\n    if (piece[2] === 'n') {\n      if (pieces[toY][toX][0][0] !== color) {\n        return knightMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'b') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        return bishopMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'r') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        return rookMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'q') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        return queenMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'k') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        if (checkCastle(pos, toX, toY, pieces)) {\n          return true;\n        } else {\n          return kingMoves(pos,toX, toY);\n        }\n      }\n    } else if (piece[2] === 'p') {\n      if (checkPawnCaptures(toX, toY, pos, pieces)) {\n        return true;\n      } else if (checkPawnObstruction(toX, toY, pieces)) {\n        return pawnMoves(toX, toY, pos, pieces);\n      }\n    }\n  },\n\n  checkPawnObstruction (toX, toY, pieces) {\n    if (pieces[toY][toX][0][0] !== 'n') {\n      return false;\n    }\n    return true;\n  },\n\n  checkCastle (pos, toX, toY, pieces) {\n    let king = [pos[1],pos[0]];\n    let color = pieces[pos[1]][pos[0]][0][0];\n    if (toX === 2 && toY === pos[1] && checkObstruction(toX - 1, toY, pos, pieces) &&\n        notInCheck(toX + 1, toY, pos, pieces) &&\n        findAttackers(king, pieces, color === 'w' ? 'b' : 'w',false).length === 0) {\n      return specialMoves[color].castleQueenSideStatus;\n    } else if (toX === 6 && toY === pos[1] && checkObstruction(toX, toY, pos, pieces) &&\n        notInCheck(toX - 1, toY, pos, pieces) &&\n        findAttackers(king, pieces, color === 'w' ? 'b' : 'w',false).length === 0) {\n      return specialMoves[color].castleKingSideStatus;\n    }\n  },\n\n  checkObstruction (toX, toY, from, pieces, sameSide = false) {\n    const [x, y] = from;\n    const color = pieces[y][x][0][0];\n    const dX = toX - x;\n    const dY = toY - y;\n    const xStep = dX / Math.abs(dX) || 0;\n    const yStep = dY / Math.abs(dY) || 0;\n    if (dX === 0 && dY !== 0) {\n      for (let i = 1; i <= Math.abs(dY);i++) {\n        if (pieces[y+(yStep*i)][x][0][0] === color && !sameSide ||\n          (pieces[y+(yStep*i)][x][0][0] !== 'n' && i < Math.abs(dY))) {\n          return false;\n        }\n      }\n      return true;\n    } else if (dY === 0  && dX !== 0) {\n      for (let i = 1; i <= Math.abs(dX);i++) {\n        if (pieces[y][x+(xStep*i)][0][0] === color && !sameSide ||\n          (pieces[y][x+(xStep*i)][0][0] !== 'n' && i < Math.abs(dX))) {\n          return false;\n        }\n      }\n      return true;\n    } else if (Math.abs(dX) / Math.abs(dY) === 1) {\n      for (let i = 1; i <= Math.abs(dX);i++) {\n        if (pieces[y+(yStep*i)][x+(xStep*i)][0][0] === color && !sameSide ||\n          (pieces[y+(yStep*i)][x+(xStep*i)][0][0] !== 'n' && i < Math.abs(dX))) {\n          return false;\n        }\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  castleRook (toX, toY, pieces) {\n    let start = toX > 4 ? [7, toY] : [0, toY];\n    let piece = pieces[start[1]][start[0]][0];\n    pieces[toY][toX][0] = piece;\n    pieces[start[1]][start[0]][0] = 'n-l';\n  },\n\n  checkEnPassant (toX, toY, from, pieces) {\n    const [x, y] = from;\n    const color = pieces[y][x][0][0];\n    const oppColor = color === 'w' ? 'b' : 'w';\n    const rightSide = toX < 7 ? pieces[toY][toX + 1][0] : ['n-l'];\n    const leftSide = toX > 0 ? pieces[toY][toX - 1][0] : ['n-l'];\n    specialMoves[oppColor].enPassant = {status: false, pos: []};\n    if (leftSide[2] === 'p' && leftSide[0] === oppColor) {\n      specialMoves[oppColor].enPassant = {status: true, pos: [toX - 1, toY, 1]};\n    } else if (rightSide[2] === 'p' && rightSide[0] === oppColor) {\n      specialMoves[oppColor].enPassant = {status: true, pos: [toX + 1, toY, -1]};\n    }\n  },\n\n  captureEnPassant (x, y, pieces) {\n    pieces[y][x][0] = 'n-l';\n  },\n\n  pawnMoves (toX, toY, from, pieces) {\n    const [x, y] = from;\n    const color = pieces[y][x][0][0];\n    const dx = color === 'w' ? toX - x : x - toX;\n    const dy = color === 'w' ? toY - y : y - toY;\n    return (\n      (dx === 0 && dy === -1) ||\n      (y === 6 && dy === -2 && dx === 0 && pieces[5][x][0][0] === 'n') ||\n      (y === 1 && dy === -2 && dx === 0 && pieces[2][x][0][0] === 'n') ||\n      checkPawnCaptures(toX, toY, from, pieces)\n    );\n  }\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./logic/ai.js\n **/"],"sourceRoot":""}