{"version":3,"sources":["webpack:///webpack/bootstrap 479d9da7ab33e2a4cb82","webpack:///./logic/move_worker.js","webpack:///./logic/board_node.js","webpack:///./logic/ai.js"],"names":["BoardNode","require","Ai","self","onmessage","e","specMoves","data","specialMoves","testBoard","dupe","board","pieces","depth","bestMove","findBestMove","workerResult","moveData","Object","assign","move","checkmate","enPassant","castle","postMessage","module","exports","moves","parseMoveClusters","findAllPieces","currentSide","map","findAllLegalMovesByPiece","piece","length","side","forEach","currentNode","score","color","returnPieces","row","i","square","j","testSquare","parseSquare","push","allSquares","allMoves","type","filter","rookMoves","pos","canMove","knightMoves","bishopMoves","queenMoves","pawnMoves","kingMoves","array","result","subArray","y","x","pieceInfo","defended","PIECE_VALUES","toX","toY","from","notInCheck","checkMove","selected","dx","dy","Math","abs","checkPawnCaptures","pawn","oppColor","dX","dY","status","afterMove","testMove","king","findKing","findAttackers","colorToCheck","sameSide","yDir","left","right","returnResult","coord","step","checkObstruction","to","start","duped","target","checkCastle","checkPawnObstruction","castleQueenSideStatus","castleKingSideStatus","xStep","yStep","castleRook","checkEnPassant","rightSide","leftSide","captureEnPassant"],"mappings":"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","file":"479d9da7ab33e2a4cb82.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 479d9da7ab33e2a4cb82\n **/","const BoardNode = require('./board_node.js');\nconst Ai = require('./ai.js');\n\nself.onmessage = function (e) {\n  let specMoves = e.data.data.specialMoves;\n  let testBoard = Ai.dupe(e.data.data.board.pieces);\n  let depth = e.data.data.depth;\n  let bestMove = BoardNode.findBestMove(testBoard,specMoves,depth);\n  let workerResult = 'Message received!';\n  let moveData = Object.assign({move: [], checkmate: false, enPassant: false, castle: false},bestMove);\n  postMessage(moveData);\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./logic/move_worker.js\n **/","const Ai = require('./ai.js');\n\nmodule.exports = {\n  findBestMove (board,specMoves,depth) {\n    let moves = parseMoveClusters(\n                  findAllPieces(board,specMoves.currentSide)\n                  .map(piece=> findAllLegalMovesByPiece(piece,board,specMoves))\n                );\n    if (moves.length === 0) return {checkmate: true, side: specMoves.currentSide};\n\n    let bestMove = null;\n    moves.forEach(move => {\n      let currentNode = new BoardNode(move,board,specMoves,depth);\n      if (currentNode.checkmate) {\n        return {move: currentNode.move, checkmate: true};\n      }\n      bestMove = bestMove ?\n        (currentNode.score > bestMove.score ?\n          currentNode : bestMove) : currentNode;\n    });\n    return {move: bestMove.move};\n  },\n\n  findAllPieces (board,color) {\n    let returnPieces = [];\n    board.forEach((row,i)=>{\n      row.forEach((square,j)=>{\n        let testSquare = parseSquare(board,i,j);\n        if (testSquare.side === color) {\n          returnPieces.push(testSquare);\n        }\n      });\n    });\n    return returnPieces;\n  },\n\n  findAllLegalMovesByPiece (piece, board, specMoves) {\n    let allSquares = [];\n    let allMoves;\n    for (let i=0;i<8;i++) {\n      for (let j=0;j<8;j++) {\n        allSquares.push([j,i]);\n      }\n    }\n    if (piece.type === 'r') {\n      allMoves = allSquares.filter(square=> {\n        return rookMoves(piece.pos, square[0], square[1]);\n      }).filter(square=> {\n        return canMove(square[0], square[1], board, piece.pos,specMoves);\n      }).map(move => [piece.pos,move]);\n    }\n\n    if (piece.type === 'n') {\n      allMoves = allSquares.filter(square=> {\n        return knightMoves(piece.pos, square[0], square[1]);\n      }).filter(square=> {\n        return canMove(square[0], square[1], board, piece.pos,specMoves);\n      }).map(move => [piece.pos,move]);\n    }\n\n    if (piece.type === 'b') {\n      allMoves = allSquares.filter(square=> {\n        return bishopMoves(piece.pos, square[0], square[1]);\n      }).filter(square=> {\n        return canMove(square[0], square[1], board, piece.pos,specMoves);\n      }).map(move => [piece.pos,move]);\n    }\n\n    if (piece.type === 'q') {\n      allMoves = allSquares.filter(square=> {\n        return queenMoves(piece.pos, square[0], square[1]);\n      }).filter(square=> {\n        return canMove(square[0], square[1], board, piece.pos,specMoves);\n      }).map(move => [piece.pos,move]);\n    }\n\n    if (piece.type === 'p') {\n      allMoves = allSquares.filter(square=> {\n        return pawnMoves(square[0], square[1], piece.pos, board);\n      }).filter(square=> {\n        return canMove(square[0], square[1], board, piece.pos,specMoves);\n      }).map(move => [piece.pos,move]);\n    }\n\n    if (piece.type === 'k') {\n      allMoves = allSquares.filter(square=> {\n        return kingMoves(piece.pos, square[0], square[1]);\n      }).filter(square=> {\n        return canMove(square[0], square[1], board, piece.pos,specMoves);\n      }).map(move => [piece.pos,move]);\n    }\n    return allMoves;\n  },\n\n  parseMoveClusters (array) {\n    let result = [];\n    array.forEach(subArray => {\n      subArray.forEach(move => {\n        result.push(move);\n      });\n    });\n    return result;\n  },\n\n  parseSquare (pieces, y, x) {\n    let pieceInfo = {\n      side: pieces[y][x][0][0],\n      type: pieces[y][x][0][2],\n      pos: [x,y],\n      defended: false\n    };\n    return pieceInfo;\n  },\n\n  PIECE_VALUES: {\n    'p': 100,\n    'r': 500,\n    'b': 300,\n    'n': 300,\n    'q': 900,\n    'k': 10000\n  }\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./logic/board_node.js\n **/","module.exports = {\n  specialMoves: {},\n\n  canMove(toX, toY, pieces, from,specMoves) {\n    specialMoves = specMoves;\n    // if (from[0] === 4 && from[1] === 0 && toX === 5 && toY === 1) debugger\n    if (notInCheck(toX, toY, from, pieces)) {\n      if (checkMove(toX, toY, pieces, from)) return true;\n    }\n    return false;\n  },\n\n  bishopMoves (selected, toX, toY) {\n    let [x, y] = selected;\n    let dx = toX - x;\n    let dy = toY - y;\n    return (Math.abs(dx) / Math.abs(dy) === 1);\n  },\n\n  rookMoves (selected, toX, toY) {\n    let [x, y] = selected;\n    let dx = toX - x;\n    let dy = toY - y;\n    return (dx === 0 && dy !== 0|| dy === 0 && dx !== 0);\n  },\n\n  queenMoves (selected, toX, toY) {\n    let [x, y] = selected;\n    let dx = toX - x;\n    let dy = toY - y;\n    return (Math.abs(dx) / Math.abs(dy) === 1) ||\n    (dx === 0 && dy !== 0|| dy === 0 && dx !== 0);\n  },\n\n  knightMoves (selected,toX, toY) {\n    const [x, y] = selected;\n    const dx = toX - x;\n    const dy = toY - y;\n    return (Math.abs(dx) === 2 && Math.abs(dy) === 1) ||\n           (Math.abs(dx) === 1 && Math.abs(dy) === 2);\n  },\n\n  kingMoves (selected, toX, toY) {\n    const [x, y] = selected;\n    const dx = toX - x;\n    const dy = toY - y;\n    return (Math.abs(dx) <= 1 && Math.abs(dy) <= 1) &&\n           (Math.abs(dx) + Math.abs(dy) > 0);\n  },\n\n  checkPawnCaptures (toX, toY, pawn, pieces) {\n    const [x, y] = pawn;\n    const color = pieces[y][x][0][0];\n    const oppColor = color === 'w' ? 'b' : 'w';\n    const dX = toX - x;\n    const dY = toY - y;\n    const enPassant = specialMoves[color].enPassant;\n    if (color === 'w' && dY > 0 || color === 'b' && dY< 0) {\n      return false;\n    } else if (Math.abs(dX) === 1 && Math.abs(dY) === 1 &&\n      pieces[toY][toX][0][0] !== color &&\n      pieces[toY][toX][0][0] !== 'n') {\n        return true;\n      } else if (enPassant.status) {\n        if (pawn[0] === enPassant.pos[0] && pawn[1] === enPassant.pos[1] &&\n          toX === x + enPassant.pos[2] && Math.abs(dY) === 1) {\n            return true;\n        }\n      }\n    return false;\n  },\n\n  notInCheck (toX, toY, from, pieces) {\n    let color = pieces[from[1]][from[0]][0][0];\n    let testBoard = dupe(pieces);\n    let afterMove = testMove(testBoard, from, [toX, toY]);\n    let king = findKing(afterMove,color); //[y,x];\n    if (findAttackers(king,afterMove,color==='w'?'b':'w',false).length > 0) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  findAttackers (piece, board, colorToCheck, sameSide) {\n    if (!piece) return false;\n    let yDir = colorToCheck === 'w' ? piece[1] + 1 : piece[1] - 1;\n    let left = piece[0] - 1;\n    let right = piece[0] + 1;\n    let returnResult = [];\n    //test for pawns\n    if (left >= 0 && left <= 7 && yDir >= 0 && yDir <= 7 &&\n      board[yDir][left][0] === `${colorToCheck}-p`) {\n      returnResult.push([true,'p']);\n    } else if (right >= 0 && right <= 7 && yDir >= 0 && yDir <= 7 &&\n      board[yDir][right][0] === `${colorToCheck}-p`) {\n      returnResult.push([true, 'p']);\n    }\n    //test for knights\n    [[1,2],[1,-2],[-1,2],[-1,-2],[2,1],[2,-1],[-2,1],[-2,-1]].forEach(coord => {\n      let x = piece[0] + coord[0];\n      let y = piece[1] + coord[1];\n      if (x >= 0 && x <=7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-n`) {\n          returnResult.push([true, 'n']);\n        }\n      }\n    });\n    //test for bishops/queens\n    [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(step => {\n      let x = piece[0] + step[0],\n        y = piece[1] + step[1];\n      while (x >= 0 && x <= 7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-b` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true, 'b']);\n        } else if (board[y][x][0] === `${colorToCheck}-q` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true, 'q']);\n        }\n        x += step[0];\n        y += step[1];\n      }\n    });\n    //test for rooks/queens\n    [[0,1],[0,-1],[-1,0],[1,0]].forEach(step => {\n      let x = piece[0] + step[0],\n        y = piece[1] + step[1];\n      while (x >= 0 && x <= 7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-r` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true, 'r']);\n        } else if (board[y][x][0] === `${colorToCheck}-q` &&\n          checkObstruction(x,y,piece,board,sameSide)) {\n          returnResult.push([true,'q']);\n        }\n        x += step[0];\n        y += step[1];\n      }\n    });\n\n    //test for king\n    [[0,1],[0,-1],[-1,0],[1,0],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(coord => {\n      let x = piece[0] + coord[0];\n      let y = piece[1] + coord[1];\n      if (x >= 0 && x <= 7 && y >= 0 && y <= 7) {\n        if (board[y][x][0] === `${colorToCheck}-k`) {\n          returnResult.push([true, 'k']);\n        }\n      }\n    });\n    return returnResult;\n  },\n\n  testMove (testBoard, from, to) {\n    let selected = from;\n    let start = testBoard[selected[1]][selected[0]][0];\n    let color = start[0];\n    if (testBoard[to[1]][to[0]][0][0] !== color) {\n      testBoard[to[1]][to[0]][0] = start;\n      testBoard[selected[1]][selected[0]][0] = 'n-l';\n    }\n    return testBoard;\n  },\n\n  dupe (array) {\n    const duped = [[],[],[],[],[],[],[],[]];\n    for (let i=0;i<array.length;i++) {\n      for (let j=0;j<array[i].length;j++) {\n        let piece = `${array[i][j][0][0]}-${array[i][j][0][2]}`;\n        duped[i].push([piece]);\n      }\n    }\n    return duped;\n  },\n\n  findKing (pieces,color) {\n    const target = `${color}-k`;\n    for (let i=0; i<=7;i++) {\n      for (let j=0; j<=7;j++) {\n        if (pieces[i][j][0] === target) {\n          return [j, i];\n        }\n      }\n    }\n  },\n\n  checkMove (toX, toY, pieces, from) {\n    let pos = from;\n    let piece = pieces[pos[1]][pos[0]][0];\n    let color = pieces[pos[1]][pos[0]][0][0];\n    if (piece[2] === 'n') {\n      if (pieces[toY][toX][0][0] !== color) {\n        return knightMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'b') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        return bishopMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'r') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        return rookMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'q') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        return queenMoves(pos,toX, toY);\n      }\n    } else if (piece[2] === 'k') {\n      if (checkObstruction(toX, toY, pos, pieces)) {\n        if (checkCastle(pos, toX, toY, pieces)) {\n          return true;\n        } else {\n          return kingMoves(pos,toX, toY);\n        }\n      }\n    } else if (piece[2] === 'p') {\n      if (checkPawnCaptures(toX, toY, pos, pieces)) {\n        return true;\n      } else if (checkPawnObstruction(toX, toY, pieces)) {\n        return pawnMoves(toX, toY, pos, pieces);\n      }\n    }\n  },\n\n  checkPawnObstruction (toX, toY, pieces) {\n    if (pieces[toY][toX][0][0] !== 'n') {\n      return false;\n    }\n    return true;\n  },\n\n  checkCastle (pos, toX, toY, pieces) {\n    let king = [pos[1],pos[0]];\n    let color = pieces[pos[1]][pos[0]][0][0];\n    if (toX === 2 && toY === pos[1] && checkObstruction(toX - 1, toY, pos, pieces) &&\n        notInCheck(toX + 1, toY, pos, pieces) &&\n        findAttackers(king, pieces, color === 'w' ? 'b' : 'w',false).length === 0) {\n      return specialMoves[color].castleQueenSideStatus;\n    } else if (toX === 6 && toY === pos[1] && checkObstruction(toX, toY, pos, pieces) &&\n        notInCheck(toX - 1, toY, pos, pieces) &&\n        findAttackers(king, pieces, color === 'w' ? 'b' : 'w',false).length === 0) {\n      return specialMoves[color].castleKingSideStatus;\n    }\n  },\n\n  checkObstruction (toX, toY, from, pieces, sameSide = false) {\n    const [x, y] = from;\n    const color = pieces[y][x][0][0];\n    const dX = toX - x;\n    const dY = toY - y;\n    const xStep = dX / Math.abs(dX) || 0;\n    const yStep = dY / Math.abs(dY) || 0;\n    if (dX === 0 && dY !== 0) {\n      for (let i = 1; i <= Math.abs(dY);i++) {\n        if (pieces[y+(yStep*i)][x][0][0] === color && !sameSide ||\n          (pieces[y+(yStep*i)][x][0][0] !== 'n' && i < Math.abs(dY))) {\n          return false;\n        }\n      }\n      return true;\n    } else if (dY === 0  && dX !== 0) {\n      for (let i = 1; i <= Math.abs(dX);i++) {\n        if (pieces[y][x+(xStep*i)][0][0] === color && !sameSide ||\n          (pieces[y][x+(xStep*i)][0][0] !== 'n' && i < Math.abs(dX))) {\n          return false;\n        }\n      }\n      return true;\n    } else if (Math.abs(dX) / Math.abs(dY) === 1) {\n      for (let i = 1; i <= Math.abs(dX);i++) {\n        if (pieces[y+(yStep*i)][x+(xStep*i)][0][0] === color && !sameSide ||\n          (pieces[y+(yStep*i)][x+(xStep*i)][0][0] !== 'n' && i < Math.abs(dX))) {\n          return false;\n        }\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  castleRook (toX, toY, pieces) {\n    let start = toX > 4 ? [7, toY] : [0, toY];\n    let piece = pieces[start[1]][start[0]][0];\n    pieces[toY][toX][0] = piece;\n    pieces[start[1]][start[0]][0] = 'n-l';\n  },\n\n  checkEnPassant (toX, toY, from, pieces) {\n    const [x, y] = from;\n    const color = pieces[y][x][0][0];\n    const oppColor = color === 'w' ? 'b' : 'w';\n    const rightSide = toX < 7 ? pieces[toY][toX + 1][0] : ['n-l'];\n    const leftSide = toX > 0 ? pieces[toY][toX - 1][0] : ['n-l'];\n    specialMoves[oppColor].enPassant = {status: false, pos: []};\n    if (leftSide[2] === 'p' && leftSide[0] === oppColor) {\n      specialMoves[oppColor].enPassant = {status: true, pos: [toX - 1, toY, 1]};\n    } else if (rightSide[2] === 'p' && rightSide[0] === oppColor) {\n      specialMoves[oppColor].enPassant = {status: true, pos: [toX + 1, toY, -1]};\n    }\n  },\n\n  captureEnPassant (x, y, pieces) {\n    pieces[y][x][0] = 'n-l';\n  },\n\n  pawnMoves (toX, toY, from, pieces) {\n    const [x, y] = from;\n    const color = pieces[y][x][0][0];\n    const dx = color === 'w' ? toX - x : x - toX;\n    const dy = color === 'w' ? toY - y : y - toY;\n    return (\n      (dx === 0 && dy === -1) ||\n      (y === 6 && dy === -2 && dx === 0 && pieces[5][x][0][0] === 'n') ||\n      (y === 1 && dy === -2 && dx === 0 && pieces[2][x][0][0] === 'n') ||\n      checkPawnCaptures(toX, toY, from, pieces)\n    );\n  }\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./logic/ai.js\n **/"],"sourceRoot":""}